<div class="userProfileContainer">
  <mat-card>
    <mat-card-header class="primary-color-background">
      <mat-card-title> Edit Profile </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <div class="userProfileImage">
        <div class="row">
          <div class="col-md-4">
            <input
              type="file"
              class="form-control image-file-picker"
              #filePicker
              (change)="onImagePicked($event)"
            />

            <div class="img-container mx-auto">
              <img class="profile-image" [src]="profileImagePreview" [alt]="userProfile.name" />

              <div class="overlay">
                <mat-error class="icon" title="User Profile" (click)="filePicker.click()">
                  <i class="fa fa-pencil"></i>
                </mat-error>
              </div>
            </div>
          </div>

          <div class="col-md-8">
            <h1>{{ userProfile.name | uppercase }}</h1>

            <div class="row" *ngIf="sports.length > 0">
              <div class="col-12">
                <mat-error *ngFor="let curSport of sports; let i = index">
                  <button type="button" class="btn btn-sports-interest btn-info">
                    <span class="">{{ curSport.sport }}&nbsp;&nbsp;</span>
                    <i class="fa fa-close" (click)="removeInterestedSport(i)"></i>
                  </button>
                </mat-error>
              </div>
            </div>

            <button
              mat-raised-button
              color="primary"
              class="rounded-btn"
              (click)="sportsInterest()"
            >
              <i class="fa fa-plus"></i>
              <span class="">&nbsp;&nbsp; Add Your Interest</span>
            </button>
          </div>
        </div>
      </div>

      <form (ngSubmit)="saveUserProfile()" [formGroup]="form" class="userProfileForm">
        <mat-form-field class="full-width">
          <mat-label for="name">Name</mat-label>
          <input matInput type="text" name="name" id="name" formControlName="name" />
          <mat-error *ngIf="form.get('name').hasError('required')"> Name is required* </mat-error>
        </mat-form-field>

        <mat-form-field class="full-width">
          <mat-label for="user-name">UserName</mat-label>
          <input matInput type="text" name="userName" id="user-name" formControlName="userName" />
          <mat-error *ngIf="form.get('userName').hasError('required')">
            User Name is required
          </mat-error>
        </mat-form-field>

        <mat-form-field class="full-width">
          <mat-label dor="story">Your Sportizen Story</mat-label>
          <textarea
            matInput
            type="text"
            name="story"
            id="story"
            rows="4"
            formControlName="story"
          ></textarea>
        </mat-form-field>

        <mat-form-field class="full-width">
          <mat-label for="email">Email Id</mat-label>
          <input matInput type="email" name="email" id="email" formControlName="emailId" />
          <mat-error *ngIf="form.get('emailId').hasError('emailId') && !form.hasError('required')">
            Please enter a valid email address
          </mat-error>
          <mat-error *ngIf="form.get('emailId').hasError('required')">
            Email is required
          </mat-error>
        </mat-form-field>

        <mat-form-field class="full-width">
          <mat-label for="phone">Phone Number</mat-label>
          <input
            type="number"
            matInput
            name="phone"
            id="phone"
            min="1000000000"
            max="9999999999"
            formControlName="phoneNo"
          />
          <mat-error *ngIf="form.get('phoneNo').hasError('required')">
            Phone Number is required
          </mat-error>
          <mat-error
            *ngIf="form.get('phoneNo').hasError('min') || form.get('phoneNo').hasError('max')"
          >
            Enter Valid Number
          </mat-error>
        </mat-form-field>

        <div class="row">
          <div class="col-md-6 text-left">
            <mat-radio-group
              aria-label="Select an option"
              name="gender"
              id="gender"
              formControlName="gender"
            >
              <mat-radio-button value="male">Male</mat-radio-button>
              <mat-radio-button value="female">Female</mat-radio-button>
            </mat-radio-group>
          </div>

          <div class="col-md-6 text-left">
            <mat-form-field appearance="fill" class="full-width">
              <mat-label for="birth-date">Birth date</mat-label>
              <input
                matInput
                name="birthDate"
                id="birth-date"
                [matDatepicker]="picker"
                formControlName="birthDate"
              />
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
              <mat-error *ngIf="form.get('birthDate').hasError('required')">
                Birth Date is required*
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <button
          type="submit"
          mat-raised-button
          color="primary"
          class="rounded-btn"
          [disabled]="loading"
        >
          Save your changes
          <mat-spinner [diameter]="20" *ngIf="loading"></mat-spinner>
        </button>
      </form>

      <mat-divider></mat-divider>

      <div class="row">
        <div class="col-12">
          <h5>
            {{ userProfile.userProvider === 'SPORTIZEN' ? 'Change Password' : 'Set Password' }}
          </h5>

          <div class="row">
            <div class="col-md-8 col-10 mx-auto">
              <form
                class="form change-password-form"
                (submit)="changePassword()"
                [formGroup]="changePasswordForm"
              >
                <mat-form-field
                  appearance="fill"
                  class="full-width"
                  *ngIf="userProfile.userProvider === 'SPORTIZEN'"
                >
                  <mat-label for="oldPassword">Current Password</mat-label>

                  <input
                    matInput
                    type="password"
                    id="oldPassword"
                    class=""
                    name="oldPassword"
                    formControlName="oldPassword"
                  />

                  <mat-error
                    *ngIf="
                      !changePasswordForm.get('oldPassword').valid &&
                      changePasswordForm.get('oldPassword').touched
                    "
                    >*Please enter Your Old Password</mat-error
                  >
                </mat-form-field>

                <mat-form-field appearance="fill" class="full-width">
                  <mat-label for="password">New Password</mat-label>

                  <input
                    matInput
                    type="password"
                    id="password"
                    name="password"
                    formControlName="password"
                  />

                  <mat-error
                    *ngIf="
                      !changePasswordForm.get('password').valid &&
                      changePasswordForm.get('password').touched
                    "
                    >*Please enter New Password</mat-error
                  >
                </mat-form-field>

                <mat-form-field appearance="fill" class="full-width">
                  <mat-label for="confirmPassword">Confirm Password</mat-label>

                  <input
                    matInput
                    type="password"
                    id="confirmPassword"
                    name="confirmPassword"
                    formControlName="confirmPassword"
                  />

                  <mat-error
                    *ngIf="
                      !changePasswordForm.get('confirmPassword').valid &&
                      changePasswordForm.get('confirmPassword').touched
                    "
                    >*Please enter Confirm Password</mat-error
                  >

                  <mat-error
                    *ngIf="
                      changePasswordForm.hasError('invalidPassword') &&
                      changePasswordForm.get('password').touched
                    "
                    >*Password & Confirm Password Does Not Match</mat-error
                  >
                </mat-form-field>

                <hr />

                <div class="row">
                  <div class="col-12">
                    <button
                      type="submit"
                      mat-raised-button
                      color="primary"
                      class="rounded-btn mb-4"
                    >
                      {{
                        userProfile.userProvider === 'SPORTIZEN'
                          ? 'Change Password'
                          : 'Set Password'
                      }}
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <mat-divider></mat-divider>
      <div class="row">
        <div class="col-12">
          <h5>Logout From All Devices</h5>

          <div class="row">
            <div class="col-md-8 col-12">
              <p class="ml-2">
                If you use Logout from all Devices, it will automatically logout from All the
                devices you are activated on sportizen, including this Device..
              </p>
            </div>

            <div class="col-md-4 col-12">
              <button type="button" class="btn btn-danger" (click)="logoutAll()">
                <i class="fa fa-sign-out"></i>&nbsp;Logout All
              </button>
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>

<app-sports-interest
  *ngIf="addSportInterest"
  [sportsInterest]="interestedSports"
  (close)="closeSportsInterest()"
  (save)="saveSportsInterest($event)"
></app-sports-interest>

<app-image-croper
  *ngIf="imageCropping"
  [image]="imagePreview"
  (close)="closeImageCropping()"
  (crop)="saveCroppedImage($event)"
></app-image-croper>
